This version is more protected against segfaults
